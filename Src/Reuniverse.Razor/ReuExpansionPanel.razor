<div class="reu-expansion-panel @CssClass" @attributes="AdditionalAttributes">
    <div class="expandable" @onclick="ToggleExpanded" @onmousedown:preventDefault="true">
        @TitleContent
    </div>
    <div class="content-container @(Expanded ? "expanded" : "collapsed")">
        <div class="content">
            @ChildContent
        </div>
    </div>
</div>

@code {
    [CascadingParameter]
    private ReuExpansionPanels? Parent { get; set; }

    [Parameter]
    public RenderFragment? TitleContent { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public bool Expanded { get; set; }

    /// <summary>
    /// Additional CSS classes to apply to the element.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    [Parameter]
    public EventCallback<bool> ExpandedChanged { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public IDictionary<string, object>? AdditionalAttributes { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        Parent?.Register(this);
    }

    private async Task ToggleExpanded()
    {
        if (Parent?.SingleExpansion == true)
        {
            Parent?.CollapseAll();
        }

        Expanded = !Expanded;
        await ExpandedChanged.InvokeAsync(Expanded);
    }

    internal void Collapse()
    {
        Expanded = false;
    }
}